[module]
name = "JsonParser"
description = "Minimal JSON parser for Telegram API responses"

[definitions]
prefix = "prop"

[invariants]
parseCallbackData_roundtrip = """
For any valid CID string and choice string,
parseCallbackData (cid ++ "|" ++ choice) == Just (cid, choice)
"""

parseUpdates_empty = """
parseUpdatesJson '{"ok":true,"result":[]}' == Right []
"""

parseUpdates_rejects_false = """
parseUpdatesJson '{"ok":false,...}' returns Left with error description
"""

cid_format = """
callback_data format is "CID|CHOICE" where CID is "agent-timestamp-seq"
"""

[tested_by]
property_tests = "test/Test/JsonParser.idr"

specs = [
  "[${prefix}_parseCallbackData_roundtrip] Roundtrip: parsing well-formed callback_data works",
  "[${prefix}_parseCallbackData_rejects_no_pipe] Rejects strings without pipe separator",
  "[${prefix}_parseCallbackData_correct_split] Correctly splits CID and choice",
  "[${prefix}_parseCallbackData_empty] Empty string returns Nothing",
  "[${prefix}_parseCallbackData_single_pipe] Single pipe returns empty parts",
  "[${prefix}_parseUpdates_empty_result] Parses empty result array",
  "[${prefix}_parseUpdates_rejects_false] Rejects ok:false responses",
  "[${prefix}_skipWs_via_integration] skipWs handles various whitespace patterns in JSON",
  "[${prefix}_skipNull_via_integration] skipNull handles null field values",
  "[${prefix}_parseJsonInt_via_integration] parseJsonInt handles large integers",
  "[${prefix}_skipJsonArray_via_integration] skipJsonArray handles nested arrays",
  "[${prefix}_skipJsonObject_via_integration] skipJsonObject handles nested objects",
  "[${prefix}_skipJsonValue_all_types] skipJsonValue handles all JSON value types",
  "[${prefix}_skipObjectFields_multiple] skipObjectFields handles multiple fields",
  "[${prefix}_skipArrayElements_multiple] skipArrayElements handles multiple array elements",
  "[${prefix}_parseCallbackData_multiple_pipes] parseCallbackData rejects strings with multiple pipes",
]
